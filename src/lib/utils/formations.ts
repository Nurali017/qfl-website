import { FormationPosition } from '@/types';

// Паттерны позиций для разных формаций
// Координаты: x (0-100 слева направо), y (0-100 снизу вверх для домашней команды)

export const FORMATION_PATTERNS: Record<string, FormationPosition[]> = {
  '4-4-2': [
    // GK
    { x: 50, y: 5 },
    // Защита (4)
    { x: 20, y: 25 },
    { x: 40, y: 25 },
    { x: 60, y: 25 },
    { x: 80, y: 25 },
    // Полузащита (4)
    { x: 20, y: 50 },
    { x: 40, y: 50 },
    { x: 60, y: 50 },
    { x: 80, y: 50 },
    // Нападение (2)
    { x: 35, y: 75 },
    { x: 65, y: 75 },
  ],

  '4-3-3': [
    // GK
    { x: 50, y: 5 },
    // Защита (4)
    { x: 20, y: 25 },
    { x: 40, y: 25 },
    { x: 60, y: 25 },
    { x: 80, y: 25 },
    // Полузащита (3)
    { x: 30, y: 50 },
    { x: 50, y: 50 },
    { x: 70, y: 50 },
    // Нападение (3)
    { x: 20, y: 75 },
    { x: 50, y: 75 },
    { x: 80, y: 75 },
  ],

  '4-2-3-1': [
    // GK
    { x: 50, y: 5 },
    // Защита (4)
    { x: 20, y: 25 },
    { x: 40, y: 25 },
    { x: 60, y: 25 },
    { x: 80, y: 25 },
    // Опорная полузащита (2)
    { x: 35, y: 42 },
    { x: 65, y: 42 },
    // Атакующая полузащита (3)
    { x: 20, y: 60 },
    { x: 50, y: 60 },
    { x: 80, y: 60 },
    // Нападающий (1)
    { x: 50, y: 76 },
  ],

  '3-5-2': [
    // GK
    { x: 50, y: 5 },
    // Защита (3)
    { x: 30, y: 25 },
    { x: 50, y: 25 },
    { x: 70, y: 25 },
    // Полузащита (5)
    { x: 15, y: 50 },
    { x: 35, y: 50 },
    { x: 50, y: 50 },
    { x: 65, y: 50 },
    { x: 85, y: 50 },
    // Нападение (2)
    { x: 35, y: 75 },
    { x: 65, y: 75 },
  ],

  '5-3-2': [
    // GK
    { x: 50, y: 5 },
    // Защита (5)
    { x: 15, y: 25 },
    { x: 32.5, y: 25 },
    { x: 50, y: 25 },
    { x: 67.5, y: 25 },
    { x: 85, y: 25 },
    // Полузащита (3)
    { x: 30, y: 50 },
    { x: 50, y: 50 },
    { x: 70, y: 50 },
    // Нападение (2)
    { x: 35, y: 75 },
    { x: 65, y: 75 },
  ],

  '3-4-3': [
    // GK
    { x: 50, y: 5 },
    // Защита (3)
    { x: 30, y: 25 },
    { x: 50, y: 25 },
    { x: 70, y: 25 },
    // Полузащита (4)
    { x: 20, y: 50 },
    { x: 40, y: 50 },
    { x: 60, y: 50 },
    { x: 80, y: 50 },
    // Нападение (3)
    { x: 20, y: 75 },
    { x: 50, y: 75 },
    { x: 80, y: 75 },
  ],

  '4-5-1': [
    // GK
    { x: 50, y: 5 },
    // Защита (4)
    { x: 20, y: 25 },
    { x: 40, y: 25 },
    { x: 60, y: 25 },
    { x: 80, y: 25 },
    // Полузащита (5) - широкая линия с опорником
    { x: 15, y: 50 },
    { x: 35, y: 45 },
    { x: 50, y: 50 },
    { x: 65, y: 45 },
    { x: 85, y: 50 },
    // Нападающий (1)
    { x: 50, y: 75 },
  ],

  '4-3-2-1': [
    // GK
    { x: 50, y: 5 },
    // Защита (4)
    { x: 20, y: 25 },
    { x: 40, y: 25 },
    { x: 60, y: 25 },
    { x: 80, y: 25 },
    // Опорная полузащита (3)
    { x: 30, y: 42 },
    { x: 50, y: 42 },
    { x: 70, y: 42 },
    // Атакующая полузащита (2)
    { x: 35, y: 60 },
    { x: 65, y: 60 },
    // Нападающий (1)
    { x: 50, y: 80 },
  ],

  '4-1-4-1': [
    // GK
    { x: 50, y: 5 },
    // Защита (4)
    { x: 20, y: 25 },
    { x: 40, y: 25 },
    { x: 60, y: 25 },
    { x: 80, y: 25 },
    // Опорник (1)
    { x: 50, y: 38 },
    // Полузащита (4)
    { x: 15, y: 55 },
    { x: 38, y: 55 },
    { x: 62, y: 55 },
    { x: 85, y: 55 },
    // Нападающий (1)
    { x: 50, y: 75 },
  ],
};

/**
 * Получить позиции игроков для указанной формации
 * @param formation - строка формации (например, "4-4-2")
 * @param invert - инвертировать позиции по вертикали (для гостевой команды)
 * @returns массив позиций для 11 игроков
 */
export function getFormationPositions(
  formation: string,
  invert: boolean = false
): FormationPosition[] {
  // Нормализация формации (удалить пробелы)
  const normalizedFormation = formation.replace(/\s/g, '');

  // Получить паттерн или использовать 4-4-2 по умолчанию
  const pattern = FORMATION_PATTERNS[normalizedFormation] || FORMATION_PATTERNS['4-4-2'];

  if (invert) {
    // Инвертировать Y координаты для гостевой команды
    return pattern.map(pos => ({
      x: pos.x,
      y: 100 - pos.y,
    }));
  }

  return pattern;
}

/**
 * Проверить, поддерживается ли формация
 */
export function isFormationSupported(formation: string): boolean {
  const normalized = formation.replace(/\s/g, '');
  return normalized in FORMATION_PATTERNS;
}

/**
 * Получить список всех поддерживаемых формаций
 */
export function getSupportedFormations(): string[] {
  return Object.keys(FORMATION_PATTERNS);
}
